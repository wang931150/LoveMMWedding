!function(t,i){"use strict";var e;t.PhysicsShape=void 0,(e=t.PhysicsShape||(t.PhysicsShape={}))[e.BoxShape=0]="BoxShape",e[e.CircleShape=1]="CircleShape",e[e.PolygonShape=2]="PolygonShape",e[e.ChainShape=3]="ChainShape",e[e.EdgeShape=4]="EdgeShape";class FixtureBox2DDef{}class Physics2DOption{}Physics2DOption.allowSleeping=!1,Physics2DOption.gravity={x:0,y:9.8},Physics2DOption.customUpdate=!1,Physics2DOption.velocityIterations=8,Physics2DOption.positionIterations=3,Physics2DOption.pixelRatio=50,Physics2DOption.debugDraw=!0,Physics2DOption.drawShape=!0,Physics2DOption.drawJoint=!0,Physics2DOption.drawAABB=!1,Physics2DOption.drawCenterOfMass=!1;class Physics2D extends i.EventDispatcher{constructor(){super(...arguments),this._eventList=[]}static get I(){return Physics2D._I||(Physics2D._I=new Physics2D)}set enableDebugDraw(t){t?this._factory.createDebugDraw(this._factory.drawFlags_shapeBit):this._factory.removeDebugDraw()}set drawShape(t){let i=this._factory.drawFlags_shapeBit;t?this._factory.appendFlags(i):this._factory.clearFlags(i)}set drawJoint(t){let i=this._factory.drawFlags_jointBit;t?this._factory.appendFlags(i):this._factory.clearFlags(i)}set drawAABB(t){let i=this._factory.drawFlags_aabbBit;t?this._factory.appendFlags(i):this._factory.clearFlags(i)}set drawPair(t){let i=this._factory.drawFlags_pairBit;t?this._factory.appendFlags(i):this._factory.clearFlags(i)}set drawCenterOfMass(t){let i=this._factory.drawFlags_centerOfMassBit;t?this._factory.appendFlags(i):this._factory.clearFlags(i)}enable(){return this._factory?this._factory.initialize().then((()=>(this.start(),Promise.resolve()))):Promise.resolve()}destroyWorld(){this._enabled=!1,this._factory.destroyWorld(),i.ILaya.physicsTimer.clear(this,this._update)}start(){this._enabled?i.ILaya.physicsTimer.clear(this,this._update):(this._enabled=!0,this._factory.start(),this.allowSleeping=Physics2DOption.allowSleeping,this._emptyBody=this._factory.createBody(null)),Physics2DOption.debugDraw?(this.enableDebugDraw=!0,this.drawShape=Physics2DOption.drawShape,this.drawJoint=Physics2DOption.drawJoint,this.drawAABB=Physics2DOption.drawAABB,this.drawCenterOfMass=Physics2DOption.drawCenterOfMass):this.enableDebugDraw=!1,this._rigiBodyList?this._rigiBodyList.clear():this._rigiBodyList=new i.SingletonList,this._updataattributeLists?this._updataattributeLists.clear():this._updataattributeLists=new i.SingletonList,!Physics2DOption.customUpdate&&i.LayaEnv.isPlaying&&i.ILaya.physicsTimer.frameLoop(1,this,this._update)}addRigidBody(t){this._rigiBodyList.add(t)}removeRigidBody(t){this._rigiBodyList.remove(t)}updataRigidBodyAttribute(t){this._updataattributeLists.add(t)}removeRigidBodyAttribute(t){this._updataattributeLists.remove(t)}_update(){for(var t=0,e=this._updataattributeLists.length;t<e;t++)this._updataattributeLists.elements[t].updatePhysicsAttribute();this._updataattributeLists.clear();var s=Math.min(i.ILaya.timer.delta/1e3,.033);this._factory.update(s),this._updatePhysicsTransformToRender();var o=this._eventList.length;if(o>0){for(t=0;t<o;t+=2)this._factory.sendEvent(this._eventList[t],this._eventList[t+1]);this._eventList.length=0}}_updatePhysicsTransformToRender(){for(var t=0,i=this._rigiBodyList.length;t<i;t++)this._rigiBodyList.elements[t].updatePhysicsTransformToRender()}stop(){this._rigiBodyList.clear(),this._updataattributeLists.clear(),i.ILaya.physicsTimer.clear(this,this._update)}get allowSleeping(){return this._factory.allowSleeping}set allowSleeping(t){this._factory.allowSleeping=t}get gravity(){return this._factory.gravity}set gravity(t){this._factory.gravity=t}getBodyCount(){return this._factory.bodyCount}getContactCount(){return this._factory.contactCount}getJointCount(){return this._factory.jointCount}get worldRoot(){return this._worldRoot||i.ILaya.stage}set worldRoot(t){if(this._worldRoot=t,t){var e=t.localToGlobal(i.Point.TEMP.setTo(0,0));this._factory.shiftOrigin(-e.x,-e.y)}}updatePhysicsByWorldRoot(){if(this.worldRoot){var t=this.worldRoot.localToGlobal(i.Point.TEMP.setTo(0,0));this._factory.shiftOrigin(-t.x,-t.y)}}}i.Laya.addInitCallback((()=>Physics2D.I.enable()));class RigidBody2DInfo{constructor(){this.position=new i.Vector2,this.linearVelocity=new i.Vector2}}class RigidBody extends i.Component{constructor(){super(...arguments),this._type="dynamic",this._allowSleep=!0,this._angularVelocity=0,this._angularDamping=0,this._linearVelocity={x:0,y:0},this._linearDamping=0,this._bullet=!1,this._allowRotation=!0,this._gravityScale=1,this.group=0,this.category=1,this.mask=-1,this.label="RigidBody"}_createBody(){if(this._body||!this.owner)return;let t=Physics2D.I._factory;var e=this.owner,s=new RigidBody2DInfo;s.position.setValue(e.globalPosX,e.globalPosY),s.angle=i.Utils.toRadian(e.globalRotation),s.allowSleep=this._allowSleep,s.angularDamping=this._angularDamping,s.angularVelocity=this._angularVelocity,s.bullet=this._bullet,s.fixedRotation=!this._allowRotation,s.gravityScale=this._gravityScale,s.linearDamping=this._linearDamping,s.group=this.group;var o=this._linearVelocity;(o&&0!=o.x||0!=o.y)&&s.linearVelocity.setValue(o.x,o.y),s.type=this._type,this._body=t.rigidBodyDef_Create(s),this._needrefeshShape(),this._updateBodyType()}_updateBodyType(){this._body&&(Physics2D.I._factory.set_rigidBody_type(this.body,this._type),"static"==this.type?Physics2D.I.removeRigidBody(this):Physics2D.I.addRigidBody(this))}_onAwake(){this.owner.cacheGlobal=!0,this._createBody(),this.owner.on("GlobaChange",this,this._globalChangeHandler)}_globalChangeHandler(t){t&RigidBody.changeFlag&&this._needrefeshShape()}_onEnable(){this._createBody(),this.owner.on("GlobaChange",this,this._globalChangeHandler)}_needrefeshShape(){Physics2D.I.updataRigidBodyAttribute(this)}updatePhysicsAttribute(){var t=Physics2D.I._factory,e=this.owner;t.set_RigibBody_Transform(this._body,e.globalPosX,e.globalPosY,i.Utils.toRadian(this.owner.globalRotation));var s=this.owner.getComponents(ColliderBase);if(s){for(var o=0,a=s.length;o<a;o++){var r=s[o];r.rigidBody=this,r.refresh()}t.retSet_rigidBody_MassData(this._body),t.set_rigidbody_Awake(this._body,!0),this.owner.event("shapeChange")}}updatePhysicsTransformToRender(){if("static"!=this.type){var t=Physics2D.I._factory;if(Physics2D.I._factory.get_rigidBody_IsAwake(this._body)){var e=i.Vector2.TempVector2;t.get_RigidBody_Position(this.body,e);var s=this.owner;s.globalRotation=i.Utils.toAngle(t.get_RigidBody_Angle(this.body)),s.setGlobalPos(e.x,e.y)}}}_onDisable(){Physics2D.I.removeRigidBody(this),Physics2D.I.removeRigidBodyAttribute(this),this.owner.off("GlobaChange",this,this._globalChangeHandler),this._body&&Physics2D.I._factory.removeBody(this._body),this._body=null}_onDestroy(){Physics2D.I.removeRigidBody(this),Physics2D.I.removeRigidBodyAttribute(this),this.owner.off("GlobaChange",this,this._globalChangeHandler),this._body&&Physics2D.I._factory.removeBody(this._body),this._body=null}getBody(){return this._body||this._onAwake(),this._body}_getOriBody(){return this._body}get body(){return this._body||this._onAwake(),this._body}applyForce(t,i){this._body||this._onAwake(),Physics2D.I._factory.rigidBody_applyForce(this._body,i,t)}applyForceToCenter(t){this._body||this._onAwake(),Physics2D.I._factory.rigidBody_applyForceToCenter(this._body,t)}applyLinearImpulse(t,i){this._body||this._onAwake(),Physics2D.I._factory.rigidbody_ApplyLinearImpulse(this._body,i,t)}applyLinearImpulseToCenter(t){this._body||this._onAwake(),Physics2D.I._factory.rigidbody_ApplyLinearImpulseToCenter(this._body,t)}applyTorque(t){this._body||this._onAwake(),Physics2D.I._factory.rigidbody_applyTorque(this._body,t)}setVelocity(t){this._body||this._onAwake(),Physics2D.I._factory.set_rigidBody_linearVelocity(this._body,t)}setAngle(t){this._body||this._onAwake();var i=Physics2D.I._factory,e=this.owner;i.set_RigibBody_Transform(this._body,e.globalPosX,e.globalPosY,t),i.set_rigidbody_Awake(this._body,!0)}getMass(){return this._body?Physics2D.I._factory.get_rigidbody_Mass(this._body):0}getCenter(){return this._body||this._onAwake(),Physics2D.I._factory.get_rigidBody_Center(this._body)}getWorldCenter(){return this._body||this._onAwake(),Physics2D.I._factory.get_rigidBody_WorldCenter(this._body)}get type(){return this._type}set type(t){this._type=t,this._updateBodyType()}get gravityScale(){return this._gravityScale}set gravityScale(t){this._gravityScale=t,this._body&&Physics2D.I._factory.set_rigidBody_gravityScale(this._body,t)}get allowRotation(){return this._allowRotation}set allowRotation(t){this._allowRotation=t,this._body&&Physics2D.I._factory.set_rigidBody_allowRotation(this._body,!t)}get allowSleep(){return this._allowSleep}set allowSleep(t){this._allowSleep=t,this._body&&Physics2D.I._factory.set_rigidBody_allowSleep(this._body,t)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this._body&&Physics2D.I._factory.set_rigidBody_angularDamping(this._body,t)}get angularVelocity(){return this._body?Physics2D.I._factory.get_rigidBody_angularVelocity(this._body):this._angularVelocity}set angularVelocity(t){this._angularVelocity=t,this._body&&Physics2D.I._factory.set_rigidBody_angularVelocity(this.body,t)}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this._body&&Physics2D.I._factory.set_rigidBody_linearDamping(this._body,t)}get linearVelocity(){if(this._body){var t=Physics2D.I._factory.get_rigidBody_linearVelocity(this._body);return{x:t.x,y:t.y}}return this._linearVelocity}set linearVelocity(t){t&&(t instanceof Array&&(t={x:t[0],y:t[1]}),this._linearVelocity=t,this._body&&Physics2D.I._factory.set_rigidBody_linearVelocity(this._body,t))}get bullet(){return this._bullet}set bullet(t){this._bullet=t,this._body&&Physics2D.I._factory.set_rigidBody_bullet(this._body,t)}getWorldPoint(t,i){return this.owner._getGlobalCacheLocalToGlobal(t,i)}getLocalPoint(t,i){return this.owner._getGlobalCacheGlobalToLocal(t,i)}}RigidBody.changeFlag=i.Sprite.Sprite_GlobalDeltaFlage_Position_X|i.Sprite.Sprite_GlobalDeltaFlage_Position_Y|i.Sprite.Sprite_GlobalDeltaFlage_Rotation|i.Sprite.Sprite_GlobalDeltaFlage_Scale_X|i.Sprite.Sprite_GlobalDeltaFlage_Scale_Y;class ColliderBase extends i.Component{get x(){return this._x}set x(t){this._x!=t&&(this._x=t,this._needupdataShapeAttribute())}get y(){return this._y}set y(t){this._y!=t&&(this._y=t,this._needupdataShapeAttribute())}get scaleX(){return this.owner.globalScaleX}get scaleY(){return this.owner.globalScaleY}constructor(){super(),this._isSensor=!1,this._density=10,this._friction=.2,this._restitution=0,this._x=0,this._y=0,this._singleton=!1}_setShapeData(t){throw"ColliderBase: must override it."}get pivotoffx(){return this._x-this.owner.pivotX}get pivotoffy(){return this._y-this.owner.pivotY}createfixture(){let t=Physics2D.I._factory;var i=this.rigidBody.body,e=ColliderBase.TempDef;e.density=this.density,e.friction=this.friction,e.isSensor=this.isSensor,e.restitution=this.restitution,e.shape=this._physicShape;let s=t.createFixtureDef(e);this._setShapeData(s._shape),this.fixture=t.createfixture(i,s)}resetFixtureData(){var t=ColliderBase.TempDef;t.density=this.density,t.friction=this.friction,t.isSensor=this.isSensor,t.restitution=this.restitution,Physics2D.I._factory.resetFixtureData(this.fixture,t),this._setShapeData(this.fixture.shape)}_onEnable(){this.owner.getComponent(RigidBody)&&(this.rigidBody=this.owner.getComponent(RigidBody),this._needupdataShapeAttribute())}_onAwake(){this.owner.getComponent(RigidBody)&&(this.rigidBody=this.owner.getComponent(RigidBody),this._needupdataShapeAttribute())}_needupdataShapeAttribute(){this.rigidBody&&this.rigidBody._needrefeshShape()}get isSensor(){return this._isSensor}set isSensor(t){this._isSensor!=t&&(this._isSensor=t,this._needupdataShapeAttribute())}get density(){return this._density}set density(t){this._density!=t&&(this._density=t,this._needupdataShapeAttribute())}get friction(){return this._friction}set friction(t){this._friction!=t&&(this._friction=t,this._needupdataShapeAttribute())}get restitution(){return this._restitution}set restitution(t){this._restitution!=t&&(this._restitution=t,this._needupdataShapeAttribute())}refresh(){if(!this.enabled)return;let t=Physics2D.I._factory;this.fixture?this.resetFixtureData():this.createfixture(),t.set_fixtureDef_GroupIndex(this.fixture,this.rigidBody.group),t.set_fixtureDef_CategoryBits(this.fixture,this.rigidBody.category),t.set_fixtureDef_maskBits(this.fixture,this.rigidBody.mask),t.set_fixture_collider(this.fixture,this)}_onDisable(){let t=Physics2D.I._factory;this.fixture&&this.rigidBody._getOriBody()&&t.rigidBody_DestroyFixture(this.rigidBody.body,this.fixture),this.fixture=null,this.rigidBody=null}}ColliderBase.TempDef=new FixtureBox2DDef;class BoxCollider extends ColliderBase{constructor(){super(),this._width=100,this._height=100,this._physicShape=t.PhysicsShape.BoxShape}_setShapeData(t){let i=.5*this._width,e=.5*this._height;var s={x:i+this.pivotoffx,y:e+this.pivotoffy};Physics2D.I._factory.set_collider_SetAsBox(t,i,e,s,Math.abs(this.scaleX),Math.abs(this.scaleY))}get width(){return this._width}set width(t){if(t<=0)throw"BoxCollider size cannot be less than 0";this._width!=t&&(this._width=t,this._needupdataShapeAttribute())}get height(){return this._height}set height(t){if(t<=0)throw"BoxCollider size cannot be less than 0";this._height!=t&&(this._height=t,this._needupdataShapeAttribute())}}class ChainCollider extends ColliderBase{constructor(){super(),this._points="0,0,100,0",this._datas=[],this._loop=!1,this._physicShape=t.PhysicsShape.ChainShape}_setShapeData(t){if(this._datas.length%2==1)throw"ChainCollider datas lenth must a multiplier of 2";Physics2D.I._factory.set_ChainShape_data(t,this.pivotoffx,this.pivotoffy,this._datas,this._loop,this.scaleX,this.scaleY)}get points(){return this._points}onAdded(){if(super.onAdded(),0==this._datas.length){let t=this.owner;this._datas.push(0,0,t.width,0,0,t.height,t.width,t.height)}}set points(t){if(!t)throw"ChainCollider points cannot be empty";this._points=t;var i=this._points.split(",");let e=i.length;this._datas=[];for(var s=0,o=e;s<o;s++)this._datas.push(parseInt(i[s]));this._needupdataShapeAttribute()}get datas(){return this._datas}set datas(t){if(!t)throw"ChainCollider datas cannot be empty";this._datas=t,this._needupdataShapeAttribute()}get loop(){return this._loop}set loop(t){this._loop!=t&&(this._loop=t,this._needupdataShapeAttribute())}}class CircleCollider extends ColliderBase{constructor(){super(),this._radius=50,this._physicShape=t.PhysicsShape.CircleShape}_setShapeData(t){var i=Math.max(Math.abs(this.scaleX),Math.abs(this.scaleY));let e=this.radius;Physics2D.I._factory.set_CircleShape_radius(t,e,i),Physics2D.I._factory.set_CircleShape_pos(t,this.x,this.y,i)}get radius(){return this._radius}set radius(t){if(t<=0)throw"CircleCollider radius cannot be less than 0";this._radius!=t&&(this._radius=t,this._needupdataShapeAttribute())}}class EdgeCollider extends ColliderBase{constructor(){super(),this._points="0,0,100,0",this._datas=[0,0,100,0],this._physicShape=t.PhysicsShape.EdgeShape}_setShapeData(t){if(this._datas.length%2==1)throw"EdgeCollider points lenth must a multiplier of 2";Physics2D.I._factory.set_EdgeShape_data(t,this.pivotoffx,this.pivotoffy,this._datas,this.scaleX,this.scaleY)}get points(){return this._points}set points(t){if(!t)throw"EdgeCollider points cannot be empty";this._points=t;var i=this._points.split(",");let e=i.length;this._datas=[];for(var s=0,o=e;s<o;s++)this._datas.push(parseInt(i[s]));this._needupdataShapeAttribute()}get datas(){return this._datas}set datas(t){if(!t)throw"EdgeCollider points cannot be empty";this._datas=t,this._needupdataShapeAttribute()}}class PolygonCollider extends ColliderBase{constructor(){super(),this._points="50,0,100,100,0,100",this._datas=[],this._physicShape=t.PhysicsShape.PolygonShape}onAdded(){super.onAdded();let t=this.owner;this._datas.push(0,0,t.width,.5*t.height,0,t.height)}_setShapeData(t){var i=this.datas.length;if(i<6)throw"PolygonCollider points must be greater than 3";if(i%2==1)throw"PolygonCollider points lenth must a multiplier of 2";Physics2D.I._factory.set_PolygonShape_data(t,this.pivotoffx,this.pivotoffy,this.datas,this.scaleX,this.scaleY)}get points(){return this._points}set points(t){if(!t)throw"PolygonCollider points cannot be empty";this._points=t;var i=this._points.split(",");let e=i.length;this._datas=[];for(var s=0,o=e;s<o;s++)this._datas.push(parseInt(i[s]));this._needupdataShapeAttribute()}get datas(){return this._datas}set datas(t){if(!t)throw"PolygonCollider points cannot be empty";this._datas=t,this._needupdataShapeAttribute()}}class JointBase extends i.Component{constructor(){super(),this._factory=Physics2D.I._factory,this._singleton=!1}getBodyAnchor(t,e,s){i.Point.TEMP.setTo(e,s);let o=t.owner;return o&&(o.transform?o.transform.transformPointN(i.Point.TEMP):(i.Point.TEMP.x*=o.scaleX,i.Point.TEMP.y*=o.scaleY)),i.Point.TEMP}get joint(){return this._joint||this._createJoint(),this._joint}_onEnable(){this._createJoint()}_onAwake(){this._createJoint()}_createJoint(){}_onDisable(){this._joint&&this._factory.getJoint_userData(this._joint)&&!this._factory.getJoint_userData_destroy(this._joint)&&Physics2D.I._factory.removeJoint(this._joint),this._joint=null}}class physics2D_DistancJointDef{constructor(){this.localAnchorA=new i.Vector2,this.localAnchorB=new i.Vector2}}class physics2D_GearJointDef{}class physics2D_MotorJointDef{constructor(){this.linearOffset=new i.Vector2}}class physics2D_MouseJointJointDef{constructor(){this.target=new i.Vector2}}class physics2D_PrismaticJointDef{constructor(){this.anchor=new i.Vector2,this.axis=new i.Vector2}}class physics2D_PulleyJointDef{constructor(){this.groundAnchorA=new i.Vector2,this.groundAnchorB=new i.Vector2,this.localAnchorA=new i.Vector2,this.localAnchorB=new i.Vector2}}class physics2D_RevoluteJointDef{constructor(){this.anchor=new i.Vector2}}class physics2D_WeldJointDef{constructor(){this.anchor=new i.Vector2}}class physics2D_WheelJointDef{constructor(){this.anchor=new i.Vector2,this.axis=new i.Vector2}}class DistanceJoint extends JointBase{constructor(){super(...arguments),this.selfAnchor=[0,0],this.otherAnchor=[0,0],this.collideConnected=!1,this._length=0,this._maxLength=-1,this._minLength=-1,this._frequency=1,this._dampingRatio=0}_createJoint(){if(!this._joint){let i=this.owner;if(this.selfBody=this.selfBody||i.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";let e=this.getBodyAnchor(this.selfBody,this.selfAnchor[0],this.selfAnchor[1]);var t=DistanceJoint._temp||(DistanceJoint._temp=new physics2D_DistancJointDef);t.bodyB=this.selfBody.getBody(),t.localAnchorB.setValue(e.x,e.y),this.selfBody.owner.on("shapeChange",this,this._refeahJoint),this.otherBody?(t.bodyA=this.otherBody.getBody(),e=this.getBodyAnchor(this.otherBody,this.otherAnchor[0],this.otherAnchor[1]),t.localAnchorA.setValue(e.x,e.y),this.otherBody.owner.on("shapeChange",this,this._refeahJoint)):(t.bodyA=Physics2D.I._emptyBody,t.localAnchorA.setValue(this.otherAnchor[0],this.otherAnchor[1])),t.dampingRatio=this._dampingRatio,t.frequency=this._frequency,t.collideConnected=this.collideConnected,t.length=this._length,t.maxLength=this._maxLength,t.minLength=this._minLength,this._joint=this._factory.createDistanceJoint(t)}}_refeahJoint(){this._joint&&this._factory.set_DistanceJointStiffnessDamping(this._joint,this._frequency,this._dampingRatio)}onDestroy(){super.onDestroy(),this.selfBody.owner.off("shapeChange",this._refeahJoint),this.otherBody&&this.otherBody.owner.off("shapeChange",this._refeahJoint)}get length(){return this._length}set length(t){this._length=t,this._joint&&this._factory.set_DistanceJoint_length(this._joint,t)}get minLength(){return this._minLength}set minLength(t){this._minLength=t,this._joint&&this._factory.set_DistanceJoint_MinLength(this._joint,t)}get maxLength(){return this._maxLength}set maxLength(t){this._maxLength=t,this._joint&&this._factory.set_DistanceJoint_MaxLength(this._joint,t)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._factory.set_DistanceJointStiffnessDamping(this._joint,this._frequency,this._dampingRatio)}get damping(){return this._dampingRatio}set damping(t){this._dampingRatio=t,this._joint&&this._factory.set_DistanceJointStiffnessDamping(this._joint,this._frequency,this._dampingRatio)}get jointLength(){return this._joint?this._factory.phyToLayaValue(this.joint.GetLength()):0}}class GearJoint extends JointBase{constructor(){super(...arguments),this.collideConnected=!1,this._ratio=1}_createJoint(){if(!this._joint){if(!this.joint1)throw"Joint1 can not be empty";if(!this.joint2)throw"Joint2 can not be empty";var t=GearJoint._temp||(GearJoint._temp=new physics2D_GearJointDef);t.bodyA=this.joint1.owner.getComponent(RigidBody).getBody(),t.bodyB=this.joint2.owner.getComponent(RigidBody).getBody(),t.joint1=this.joint1.joint,t.joint2=this.joint2.joint,t.ratio=-this._ratio,t.collideConnected=this.collideConnected,this._joint=this._factory.create_GearJoint(t)}}get ratio(){return this._ratio}set ratio(t){this._ratio=t,this._joint&&this._factory.set_GearJoint_SetRatio(this._joint,t)}}class MotorJoint extends JointBase{constructor(){super(...arguments),this.collideConnected=!1,this._linearOffset=[0,0],this._angularOffset=0,this._maxForce=1e3,this._maxTorque=1e3,this._correctionFactor=.3}_createJoint(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=MotorJoint._temp||(MotorJoint._temp=new physics2D_MotorJointDef);t.bodyA=this.selfBody.getBody(),t.bodyB=this.otherBody.getBody(),t.linearOffset.setValue(this._linearOffset[0],this._linearOffset[1]),t.angularOffset=i.Utils.toRadian(-this._angularOffset),t.maxForce=this._maxForce,t.maxTorque=this._maxTorque,t.correctionFactor=this._correctionFactor,t.collideConnected=this.collideConnected,this._joint=this._factory.create_MotorJoint(t)}}get linearOffset(){return this._linearOffset}set linearOffset(t){this._linearOffset=t,this._joint&&this._factory.set_MotorJoint_linearOffset(this._joint,t[0],t[1])}get angularOffset(){return this._angularOffset}set angularOffset(t){this._angularOffset=t,this._joint&&this._factory.set_MotorJoint_SetAngularOffset(this._joint,i.Utils.toRadian(-t))}get maxForce(){return this._maxForce}set maxForce(t){this._maxForce=t,this._joint&&this._factory.set_MotorJoint_SetMaxForce(this._joint,t)}get maxTorque(){return this._maxTorque}set maxTorque(t){this._maxTorque=t,this._joint&&this._factory.set_MotorJoint_SetMaxTorque(this._joint,t)}get correctionFactor(){return this._correctionFactor}set correctionFactor(t){this._correctionFactor=t,this._joint&&this._factory.set_MotorJoint_SetCorrectionFactor(this._joint,t)}}class MouseJoint extends JointBase{constructor(){super(...arguments),this._maxForce=1e3,this._frequency=5,this._dampingRatio=.7}_onEnable(){this.owner.mouseEnabled=!0,this.owner.on(i.Event.MOUSE_DOWN,this,this.onMouseDown)}_onAwake(){}onMouseDown(){this._createJoint(),i.ILaya.stage.on(i.Event.MOUSE_MOVE,this,this.onMouseMove),i.ILaya.stage.once(i.Event.MOUSE_UP,this,this.onStageMouseUp),i.ILaya.stage.once(i.Event.MOUSE_OUT,this,this.onStageMouseUp)}_createJoint(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=MouseJoint._temp||(MouseJoint._temp=new physics2D_MouseJointJointDef);if(this.anchor)var e=this.selfBody.owner.localToGlobal(i.Point.TEMP.setTo(this.anchor[0],this.anchor[1]),!1,Physics2D.I.worldRoot);else e=Physics2D.I.worldRoot.globalToLocal(i.Point.TEMP.setTo(i.ILaya.stage.mouseX,i.ILaya.stage.mouseY));t.bodyA=Physics2D.I._emptyBody,t.bodyB=this.selfBody.getBody(),t.target.setValue(e.x,e.y),t.maxForce=this._maxForce,t.dampingRatio=this._dampingRatio,t.frequency=this._frequency,this._factory.set_rigidbody_Awake(t.bodyB,!0),this._joint=this._factory.create_MouseJoint(t)}}onStageMouseUp(){i.ILaya.stage.off(i.Event.MOUSE_MOVE,this,this.onMouseMove),i.ILaya.stage.off(i.Event.MOUSE_UP,this,this.onStageMouseUp),i.ILaya.stage.off(i.Event.MOUSE_OUT,this,this.onStageMouseUp),this._factory.removeJoint(this._joint),this._joint=null}onMouseMove(){this._joint&&this._factory.set_MouseJoint_target(this._joint,Physics2D.I.worldRoot.mouseX,Physics2D.I.worldRoot.mouseY)}_onDisable(){super._onDisable(),this.owner.off(i.Event.MOUSE_DOWN,this,this.onMouseDown)}get maxForce(){return this._maxForce}set maxForce(t){this._maxForce=t,this._joint&&this._factory.set_MotorJoint_SetMaxForce(this._joint,t)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._factory.set_MouseJoint_frequencyAndDampingRatio(this._joint,this._frequency,this._dampingRatio)}get damping(){return this._dampingRatio}set damping(t){this._dampingRatio=t,this._joint&&this._factory.set_MouseJoint_frequencyAndDampingRatio(this._joint,this._frequency,this._dampingRatio)}}class PrismaticJoint extends JointBase{constructor(){super(...arguments),this.anchor=[0,0],this._axis=[1,0],this.angle=0,this.collideConnected=!1,this._enableMotor=!1,this._motorSpeed=0,this._maxMotorForce=1e4,this._enableLimit=!1,this._lowerTranslation=0,this._upperTranslation=0}_createJoint(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=PrismaticJoint._temp||(PrismaticJoint._temp=new physics2D_PrismaticJointDef);t.bodyB=this.selfBody.getBody(),t.bodyA=this.otherBody?this.otherBody.getBody():Physics2D.I._emptyBody;let e=this.selfBody.getWorldPoint(this.anchor[0],this.anchor[1]);t.anchor.setValue(e.x,e.y);let s=i.Utils.toRadian(this.angle);t.axis.setValue(Math.cos(s),Math.sin(s)),t.enableMotor=this._enableMotor,t.motorSpeed=this._motorSpeed,t.maxMotorForce=this._maxMotorForce,t.enableLimit=this._enableLimit,t.lowerTranslation=this._lowerTranslation,t.upperTranslation=this._upperTranslation,t.collideConnected=this.collideConnected,this._joint=this._factory.create_PrismaticJoint(t)}}get enableMotor(){return this._enableMotor}set enableMotor(t){this._enableMotor=t,this._joint&&this._factory.set_Joint_EnableMotor(this._joint,t)}get motorSpeed(){return this._motorSpeed}set motorSpeed(t){this._motorSpeed=t,this._joint&&this._factory.set_Joint_SetMotorSpeed(this._joint,t)}get maxMotorForce(){return this._maxMotorForce}set maxMotorForce(t){this._maxMotorForce=t,this._joint&&this._factory.set_Joint_SetMaxMotorTorque(this._joint,t)}get enableLimit(){return this._enableLimit}set enableLimit(t){this._enableLimit=t,this._joint&&this._factory.set_Joint_EnableLimit(this._joint,t)}get lowerTranslation(){return this._lowerTranslation}set lowerTranslation(t){this._lowerTranslation=t,this._joint&&this._factory.set_Joint_SetLimits(this._joint,t,this._upperTranslation)}get upperTranslation(){return this._upperTranslation}set upperTranslation(t){this._upperTranslation=t,this._joint&&this._factory.set_Joint_SetLimits(this._joint,this._lowerTranslation,t)}get axis(){return this._axis}set axis(t){this._axis=t,this.angle=i.Utils.toAngle(Math.atan2(t[1],t[0]))}}class PulleyJoint extends JointBase{constructor(){super(...arguments),this.selfAnchor=[0,0],this.otherAnchor=[0,0],this.selfGroundPoint=[0,-100],this.otherGroundPoint=[0,-100],this.ratio=1,this.collideConnected=!1}_createJoint(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=PulleyJoint._temp||(PulleyJoint._temp=new physics2D_PulleyJointDef);t.bodyA=this.otherBody.getBody(),t.bodyB=this.selfBody.getBody();var i=this.otherBody.getWorldPoint(this.otherAnchor[0],this.otherAnchor[1]);t.localAnchorA.setValue(i.x,i.y);var e=this.selfBody.getWorldPoint(this.selfAnchor[0],this.selfAnchor[1]);t.localAnchorB.setValue(e.x,e.y);var s=this.otherBody.getWorldPoint(this.otherGroundPoint[0],this.otherGroundPoint[1]);t.groundAnchorA.setValue(s.x,s.y);var o=this.selfBody.getWorldPoint(this.selfGroundPoint[0],this.selfGroundPoint[1]);t.groundAnchorB.setValue(o.x,o.y),t.ratio=this.ratio,t.collideConnected=this.collideConnected,this._joint=Physics2D.I._factory.create_PulleyJoint(t)}}}class RevoluteJoint extends JointBase{constructor(){super(...arguments),this.anchor=[0,0],this.collideConnected=!1,this._enableMotor=!1,this._motorSpeed=0,this._maxMotorTorque=1e4,this._enableLimit=!1,this._lowerAngle=0,this._upperAngle=0}_createJoint(){if(!this._joint){if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=RevoluteJoint._temp||(RevoluteJoint._temp=new physics2D_RevoluteJointDef);t.bodyB=this.selfBody.getBody(),t.bodyA=this.otherBody?this.otherBody.getBody():Physics2D.I._emptyBody;let e=this.selfBody.getWorldPoint(this.anchor[0],this.anchor[1]);t.anchor.setValue(e.x,e.y),t.enableMotor=this._enableMotor,t.motorSpeed=this._motorSpeed,t.maxMotorTorque=this._maxMotorTorque,t.enableLimit=this._enableLimit,t.lowerAngle=i.Utils.toRadian(this._lowerAngle),t.upperAngle=i.Utils.toRadian(this._upperAngle),t.collideConnected=this.collideConnected,this._joint=this._factory.create_RevoluteJoint(t)}}get enableMotor(){return this._enableMotor}set enableMotor(t){this._enableMotor=t,this._joint&&this._factory.set_Joint_EnableMotor(this._joint,t)}get motorSpeed(){return this._motorSpeed}set motorSpeed(t){this._motorSpeed=t,this._joint&&this._factory.set_Joint_SetMotorSpeed(this._joint,t)}get maxMotorTorque(){return this._maxMotorTorque}set maxMotorTorque(t){this._maxMotorTorque=t,this._joint&&this._factory.set_Joint_SetMaxMotorTorque(this._joint,t)}get enableLimit(){return this._enableLimit}set enableLimit(t){this._enableLimit=t,this._joint&&this._factory.set_Joint_EnableLimit(this._joint,t)}get lowerAngle(){return this._lowerAngle}set lowerAngle(t){this._lowerAngle=t,this._joint&&this._factory.set_Joint_SetLimits(this._joint,i.Utils.toRadian(t),i.Utils.toRadian(this._upperAngle))}get upperAngle(){return this._upperAngle}set upperAngle(t){this._upperAngle=t,this._joint&&this._factory.set_Joint_SetLimits(this._joint,i.Utils.toRadian(this._lowerAngle),i.Utils.toRadian(t))}}class WeldJoint extends JointBase{constructor(){super(...arguments),this.anchor=[0,0],this.collideConnected=!1,this._frequency=5,this._dampingRatio=.7}_createJoint(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=WeldJoint._temp||(WeldJoint._temp=new physics2D_WeldJointDef),i=this.selfBody.getWorldPoint(this.anchor[0],this.anchor[1]);t.bodyA=this.otherBody.getBody(),t.bodyB=this.selfBody.getBody(),t.anchor.setValue(i.x,i.y),t.frequency=this._frequency,t.dampingRatio=this._dampingRatio,t.collideConnected=this.collideConnected,this._joint=this._factory.create_WeldJoint(t)}}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._factory.set_Joint_frequencyAndDampingRatio(this._joint,this._frequency,this._dampingRatio,!1)}get damping(){return this._dampingRatio}set damping(t){this._dampingRatio=t,this._joint&&this._factory.set_Joint_frequencyAndDampingRatio(this._joint,this._frequency,this._dampingRatio,!0)}}class WheelJoint extends JointBase{constructor(){super(...arguments),this.anchor=[0,0],this.collideConnected=!1,this._axis=[0,1],this.angle=90,this._frequency=1,this._dampingRatio=.7,this._enableMotor=!1,this._motorSpeed=0,this._maxMotorTorque=1e4,this._enableLimit=!0,this._lowerTranslation=0,this._upperTranslation=0}_createJoint(){if(!this._joint){if(!this.otherBody)throw"otherBody can not be empty";if(this.selfBody=this.selfBody||this.owner.getComponent(RigidBody),!this.selfBody)throw"selfBody can not be empty";var t=WheelJoint._temp||(WheelJoint._temp=new physics2D_WheelJointDef),e=this.selfBody.getWorldPoint(this.anchor[0],this.anchor[1]);t.anchor.setValue(e.x,e.y);let s=i.Utils.toRadian(this.angle);t.axis.setValue(Math.cos(s),Math.sin(s)),t.bodyA=this.otherBody.getBody(),t.bodyB=this.selfBody.getBody(),t.enableMotor=this._enableMotor,t.motorSpeed=this._motorSpeed,t.maxMotorTorque=this._maxMotorTorque,t.collideConnected=this.collideConnected,t.enableLimit=this._enableLimit,t.lowerTranslation=this._lowerTranslation,t.upperTranslation=this._upperTranslation,t.frequency=this._frequency,t.dampingRatio=this._dampingRatio,this._joint=this._factory.create_WheelJoint(t)}}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._factory.set_Joint_frequencyAndDampingRatio(this._joint,this._frequency,this._dampingRatio,!1)}get damping(){return this._dampingRatio}set damping(t){this._dampingRatio=t,this._joint&&this._factory.set_Joint_frequencyAndDampingRatio(this._joint,this._frequency,this._dampingRatio,!0)}get enableMotor(){return this._enableMotor}set enableMotor(t){this._enableMotor=t,this._joint&&this._factory.set_Joint_EnableMotor(this._joint,t)}get motorSpeed(){return this._motorSpeed}set motorSpeed(t){this._motorSpeed=t,this._joint&&this._factory.set_Joint_SetMotorSpeed(this._joint,t)}get maxMotorTorque(){return this._maxMotorTorque}set maxMotorTorque(t){this._maxMotorTorque=t,this._joint&&this._factory.set_Joint_SetMaxMotorTorque(this._joint,t)}get enableLimit(){return this._enableLimit}set enableLimit(t){this._enableLimit=t,this._joint&&this._factory.set_Joint_EnableLimit(this._joint,t)}get lowerTranslation(){return this._lowerTranslation}set lowerTranslation(t){this._lowerTranslation=t,this._joint&&this._factory.set_Joint_SetLimits(this._joint,t,this._upperTranslation)}get upperTranslation(){return this._upperTranslation}set upperTranslation(t){this._upperTranslation=t,this._joint&&this._factory.set_Joint_SetLimits(this._joint,this._lowerTranslation,t)}get axis(){return this._axis}set axis(t){this._axis=t,this.angle=i.Utils.toAngle(Math.atan2(t[1],t[0]))}}class Physics2DDebugDraw extends i.Sprite{constructor(t){super(),this._factory=t,this.DrawString_color="#E69999",this.Red="#ff0000",this.Green="#00ff00",this._camera={},this._camera.m_center=new i.Vector2(0,0),this._camera.m_extent=25,this._camera.m_zoom=1,this._camera.m_width=1280,this._camera.m_height=800,this._mG=new i.Graphics,this.graphics=this._mG,this._textSp=new i.Sprite,this._textG=this._textSp.graphics,this.addChild(this._textSp)}render(t,i,e){this._renderToGraphic(),super.render(t,i,e)}_renderToGraphic(){this._factory.world&&(this._textG.clear(),this._mG.clear(),this._mG.save(),this._mG.scale(this._factory.PIXEL_RATIO,this._factory.PIXEL_RATIO),this._lineWidth=this._factory.layaToPhyValue(1),this._factory.world.DebugDraw?this._factory.world.DebugDraw():this._factory.world.DrawDebugData(),this._mG.restore())}PushTransform(t,i,e){this._mG.save(),this._mG.translate(t,i),this._mG.rotate(e)}PopTransform(){this._mG.restore()}get mG(){return this._mG}get textG(){return this._textG}get lineWidth(){return this._lineWidth}get camera(){return this._camera}}let s=i.ClassUtils.regClass;s("Physics2D",Physics2D),s("Physics2DDebugDraw",Physics2DDebugDraw),s("ColliderBase",ColliderBase),s("BoxCollider",BoxCollider),s("ChainCollider",ChainCollider),s("CircleCollider",CircleCollider),s("EdgeCollider",EdgeCollider),s("PolygonCollider",PolygonCollider),s("RigidBody",RigidBody),s("JointBase",JointBase),s("DistanceJoint",DistanceJoint),s("GearJoint",GearJoint),s("MotorJoint",MotorJoint),s("MouseJoint",MouseJoint),s("PrismaticJoint",PrismaticJoint),s("PulleyJoint",PulleyJoint),s("RevoluteJoint",RevoluteJoint),s("WeldJoint",WeldJoint),s("WheelJoint",WheelJoint),t.BoxCollider=BoxCollider,t.ChainCollider=ChainCollider,t.CircleCollider=CircleCollider,t.ColliderBase=ColliderBase,t.DistanceJoint=DistanceJoint,t.EdgeCollider=EdgeCollider,t.FixtureBox2DDef=FixtureBox2DDef,t.GearJoint=GearJoint,t.JointBase=JointBase,t.MotorJoint=MotorJoint,t.MouseJoint=MouseJoint,t.Physics2D=Physics2D,t.Physics2DDebugDraw=Physics2DDebugDraw,t.Physics2DOption=Physics2DOption,t.PolygonCollider=PolygonCollider,t.PrismaticJoint=PrismaticJoint,t.PulleyJoint=PulleyJoint,t.RevoluteJoint=RevoluteJoint,t.RigidBody=RigidBody,t.RigidBody2DInfo=RigidBody2DInfo,t.WeldJoint=WeldJoint,t.WheelJoint=WheelJoint,t.physics2D_DistancJointDef=physics2D_DistancJointDef,t.physics2D_GearJointDef=physics2D_GearJointDef,t.physics2D_MotorJointDef=physics2D_MotorJointDef,t.physics2D_MouseJointJointDef=physics2D_MouseJointJointDef,t.physics2D_PrismaticJointDef=physics2D_PrismaticJointDef,t.physics2D_PulleyJointDef=physics2D_PulleyJointDef,t.physics2D_RevoluteJointDef=physics2D_RevoluteJointDef,t.physics2D_WeldJointDef=physics2D_WeldJointDef,t.physics2D_WheelJointDef=physics2D_WheelJointDef}(window.Laya=window.Laya||{},Laya);
//# sourceMappingURL=laya.physics2D.js.map